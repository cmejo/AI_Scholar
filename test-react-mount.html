<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Mount Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .success { background: #1a4d3a; border-color: #10b981; }
        .error { background: #4d1a1a; border-color: #ef4444; }
        .warning { background: #4d3a1a; border-color: #f59e0b; }
        .info { background: #1a3a4d; border-color: #3b82f6; }
        .test-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #374151;
            border-radius: 8px;
            background: white;
            margin: 20px 0;
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        .console-log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ React Mount Verification Test</h1>
        
        <div class="status info">
            <h3>üìã Test Objective</h3>
            <p>Verify that the React application is properly mounting and rendering in the browser.</p>
        </div>

        <div id="test-results">
            <div class="status warning">
                <h3>‚è≥ Running Tests...</h3>
                <p>Please wait while we check the React application status.</p>
            </div>
        </div>

        <div class="console-log" id="console-log">
            Starting React mount test...<br>
        </div>

        <button onclick="runTest()">üîÑ Run Test Again</button>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
        <button onclick="openApp()">üöÄ Open App in New Tab</button>

        <h2>üì± Live Application</h2>
        <iframe src="http://localhost:8080" class="test-frame" id="test-frame"></iframe>
    </div>

    <script>
        const consoleLog = document.getElementById('console-log');
        const testResults = document.getElementById('test-results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00ff00',
                error: '#ff4444',
                warning: '#ffaa00',
                success: '#00ff88'
            };
            consoleLog.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span><br>`;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        function clearLog() {
            consoleLog.innerHTML = 'Console cleared...<br>';
        }

        function openApp() {
            window.open('http://localhost:8080', '_blank');
        }

        async function checkBundleContent() {
            log('üîç Checking bundle content...', 'info');
            
            try {
                const response = await fetch('http://localhost:8080');
                const html = await response.text();
                
                const scriptMatch = html.match(/src="([^"]*index[^"]*\.js)"/);
                if (!scriptMatch) {
                    throw new Error('No bundle script found in HTML');
                }
                
                const bundlePath = scriptMatch[1];
                log(`üì¶ Found bundle: ${bundlePath}`, 'success');
                
                const bundleResponse = await fetch(`http://localhost:8080${bundlePath}`);
                const bundleContent = await bundleResponse.text();
                
                const bundleSize = (bundleContent.length / 1024).toFixed(2);
                log(`üìä Bundle size: ${bundleSize} KB`, 'info');
                
                // Check for React indicators
                const hasReactHooks = bundleContent.includes('useState') || bundleContent.includes('useEffect');
                const hasJSX = bundleContent.includes('jsx') || bundleContent.includes('createElement');
                const hasComponents = bundleContent.includes('Component') || bundleContent.includes('render');
                
                log(`üîß React hooks detected: ${hasReactHooks ? '‚úÖ' : '‚ùå'}`, hasReactHooks ? 'success' : 'error');
                log(`üèóÔ∏è JSX/createElement detected: ${hasJSX ? '‚úÖ' : '‚ùå'}`, hasJSX ? 'success' : 'error');
                log(`üß© Components detected: ${hasComponents ? '‚úÖ' : '‚ùå'}`, hasComponents ? 'success' : 'error');
                
                return {
                    bundlePath,
                    bundleSize,
                    hasReactHooks,
                    hasJSX,
                    hasComponents,
                    isValid: hasReactHooks && (hasJSX || hasComponents)
                };
                
            } catch (error) {
                log(`‚ùå Bundle check failed: ${error.message}`, 'error');
                return { isValid: false, error: error.message };
            }
        }

        async function checkDOMMount() {
            log('üîç Checking DOM mount status...', 'info');
            
            return new Promise((resolve) => {
                const iframe = document.getElementById('test-frame');
                let checkCount = 0;
                const maxChecks = 10;
                
                const checkInterval = setInterval(() => {
                    checkCount++;
                    
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const rootElement = iframeDoc.getElementById('root');
                        
                        if (rootElement) {
                            const hasContent = rootElement.innerHTML.trim().length > 0;
                            const childCount = rootElement.children.length;
                            
                            log(`üéØ Root element found`, 'success');
                            log(`üìù Has content: ${hasContent ? '‚úÖ' : '‚ùå'}`, hasContent ? 'success' : 'warning');
                            log(`üë∂ Child elements: ${childCount}`, 'info');
                            
                            if (hasContent && childCount > 0) {
                                log(`‚úÖ React app appears to be mounted!`, 'success');
                                clearInterval(checkInterval);
                                resolve({ mounted: true, hasContent, childCount });
                                return;
                            }
                        }
                        
                        if (checkCount >= maxChecks) {
                            log(`‚è∞ Timeout: App may not be mounting properly`, 'warning');
                            clearInterval(checkInterval);
                            resolve({ mounted: false, timeout: true });
                        } else {
                            log(`‚è≥ Check ${checkCount}/${maxChecks}: Waiting for mount...`, 'info');
                        }
                        
                    } catch (error) {
                        if (checkCount === 1) {
                            log(`‚ö†Ô∏è Cannot access iframe content (CORS protection)`, 'warning');
                            log(`üîí This is normal for cross-origin content`, 'info');
                        }
                        
                        if (checkCount >= maxChecks) {
                            clearInterval(checkInterval);
                            resolve({ mounted: 'unknown', corsBlocked: true });
                        }
                    }
                }, 1000);
            });
        }

        async function runTest() {
            log('üöÄ Starting React mount verification test...', 'info');
            testResults.innerHTML = '<div class="status warning"><h3>‚è≥ Running Tests...</h3><p>Please wait...</p></div>';
            
            // Step 1: Check bundle
            const bundleResult = await checkBundleContent();
            
            if (!bundleResult.isValid) {
                testResults.innerHTML = `
                    <div class="status error">
                        <h3>‚ùå Bundle Check Failed</h3>
                        <p>The React bundle appears to be invalid or missing React components.</p>
                        <p><strong>Error:</strong> ${bundleResult.error || 'Bundle validation failed'}</p>
                    </div>
                `;
                return;
            }
            
            // Step 2: Wait for iframe to load
            log('‚è≥ Waiting for iframe to load...', 'info');
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Step 3: Check DOM mount
            const mountResult = await checkDOMMount();
            
            // Display results
            if (mountResult.mounted === true) {
                testResults.innerHTML = `
                    <div class="status success">
                        <h3>‚úÖ React App Successfully Mounted!</h3>
                        <p>The React application is properly rendering with ${mountResult.childCount} child elements.</p>
                        <p><strong>Bundle:</strong> ${bundleResult.bundlePath} (${bundleResult.bundleSize} KB)</p>
                    </div>
                `;
                log('üéâ Test completed successfully!', 'success');
            } else if (mountResult.corsBlocked) {
                testResults.innerHTML = `
                    <div class="status warning">
                        <h3>‚ö†Ô∏è Mount Status Unknown (CORS Protected)</h3>
                        <p>Cannot verify mount status due to browser security restrictions.</p>
                        <p><strong>Bundle:</strong> Valid React bundle detected (${bundleResult.bundleSize} KB)</p>
                        <p><strong>Recommendation:</strong> Check the app manually in the iframe above.</p>
                    </div>
                `;
                log('‚ö†Ô∏è Test completed with limitations due to CORS', 'warning');
            } else {
                testResults.innerHTML = `
                    <div class="status error">
                        <h3>‚ùå React App Not Mounting</h3>
                        <p>The React application bundle is valid but the app is not mounting properly.</p>
                        <p><strong>Bundle:</strong> ${bundleResult.bundlePath} (${bundleResult.bundleSize} KB)</p>
                        <p><strong>Possible Issues:</strong> JavaScript errors, missing dependencies, or runtime failures.</p>
                    </div>
                `;
                log('‚ùå Test failed - app not mounting', 'error');
            }
        }

        // Auto-run test when page loads
        window.addEventListener('load', () => {
            setTimeout(runTest, 1000);
        });

        // Monitor iframe load events
        document.getElementById('test-frame').addEventListener('load', () => {
            log('üì± Iframe loaded', 'info');
        });
    </script>
</body>
</html>