<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug JavaScript Errors</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .error-log {
            background: #2d1b1b;
            border: 1px solid #8b5a5a;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #1b2d1b;
            border: 1px solid #5a8b5a;
            color: #90ee90;
        }
        .info {
            background: #1b1b2d;
            border: 1px solid #5a5a8b;
            color: #87ceeb;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 2px solid #444;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üêõ JavaScript Error Debugger</h1>
    
    <div id="error-log"></div>
    
    <h2>üì± App Preview</h2>
    <iframe src="http://localhost:8080" id="app-frame"></iframe>
    
    <script>
        const errorLog = document.getElementById('error-log');
        const errors = [];
        
        function logMessage(type, message, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `error-log ${type}`;
            logEntry.textContent = `[${timestamp}] ${type.toUpperCase()}: ${message}${details ? '\n' + details : ''}`;
            errorLog.appendChild(logEntry);
            
            if (type === 'error') {
                errors.push({ timestamp, message, details });
            }
        }
        
        // Capture all JavaScript errors
        window.addEventListener('error', (event) => {
            logMessage('error', `JavaScript Error: ${event.message}`, 
                `File: ${event.filename}\nLine: ${event.lineno}\nColumn: ${event.colno}\nStack: ${event.error?.stack || 'No stack trace'}`);
        });
        
        // Capture unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            logMessage('error', `Unhandled Promise Rejection: ${event.reason}`, 
                `Promise: ${event.promise}\nReason: ${typeof event.reason === 'object' ? JSON.stringify(event.reason, null, 2) : event.reason}`);
        });
        
        // Test basic connectivity
        logMessage('info', 'Starting connectivity test...');
        
        fetch('http://localhost:8080')
            .then(response => {
                if (response.ok) {
                    logMessage('success', 'Main app server is responding');
                    return response.text();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(html => {
                logMessage('info', `HTML loaded (${html.length} characters)`);
                
                // Check for React root
                if (html.includes('<div id="root">')) {
                    logMessage('success', 'React root element found in HTML');
                } else {
                    logMessage('error', 'React root element missing from HTML');
                }
                
                // Check for JavaScript bundle
                const scriptMatch = html.match(/src="([^"]*\.js)"/);
                if (scriptMatch) {
                    logMessage('success', `JavaScript bundle found: ${scriptMatch[1]}`);
                    
                    // Test if the bundle loads
                    fetch(`http://localhost:8080${scriptMatch[1]}`)
                        .then(response => {
                            if (response.ok) {
                                logMessage('success', 'JavaScript bundle loads successfully');
                                return response.text();
                            } else {
                                throw new Error(`Bundle HTTP ${response.status}`);
                            }
                        })
                        .then(jsContent => {
                            logMessage('info', `JavaScript bundle size: ${jsContent.length} characters`);
                            
                            // Check for React in the bundle
                            if (jsContent.includes('React') || jsContent.includes('createElement')) {
                                logMessage('success', 'React code detected in bundle');
                            } else {
                                logMessage('error', 'React code not detected in bundle');
                            }
                            
                            // Check for our component
                            if (jsContent.includes('Ultra Simple Test') || jsContent.includes('UltraSimpleTest')) {
                                logMessage('success', 'Our component code found in bundle');
                            } else {
                                logMessage('error', 'Our component code not found in bundle');
                            }
                        })
                        .catch(error => {
                            logMessage('error', `Failed to load JavaScript bundle: ${error.message}`);
                        });
                } else {
                    logMessage('error', 'No JavaScript bundle found in HTML');
                }
            })
            .catch(error => {
                logMessage('error', `Failed to connect to main app: ${error.message}`);
            });
        
        // Monitor iframe loading
        const iframe = document.getElementById('app-frame');
        iframe.onload = () => {
            logMessage('info', 'Iframe loaded successfully');
            
            // Try to check iframe content (will fail due to CORS, but that's expected)
            setTimeout(() => {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (iframeDoc) {
                        const root = iframeDoc.getElementById('root');
                        if (root && root.children.length > 0) {
                            logMessage('success', 'React app is rendering content in iframe');
                        } else if (root) {
                            logMessage('error', 'React root exists but is empty (white screen)');
                        } else {
                            logMessage('error', 'React root not found in iframe');
                        }
                    }
                } catch (e) {
                    logMessage('info', 'Cannot access iframe content due to CORS (this is normal)');
                }
            }, 3000);
        };
        
        iframe.onerror = () => {
            logMessage('error', 'Iframe failed to load');
        };
        
        // Summary after 5 seconds
        setTimeout(() => {
            if (errors.length === 0) {
                logMessage('success', 'No JavaScript errors detected! If you still see a white screen, the issue may be with React rendering or CSS.');
            } else {
                logMessage('error', `Found ${errors.length} JavaScript error(s). Check the errors above for details.`);
            }
        }, 5000);
    </script>
</body>
</html>