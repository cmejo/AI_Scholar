<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Scholar - Research Assistant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: white;
            min-height: 100vh;
        }
        .app-container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 280px;
            background: rgba(0,0,0,0.3);
            border-right: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6366f1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .nav-menu {
            flex: 1;
            padding: 1rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255,255,255,0.7);
        }
        .nav-item:hover {
            background: rgba(99, 102, 241, 0.2);
            color: white;
        }
        .nav-item.active {
            background: rgba(99, 102, 241, 0.3);
            color: white;
        }
        .nav-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .header {
            height: 70px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
        }
        .header-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .user-menu:hover {
            background: rgba(0,0,0,0.5);
        }
        .login-button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        .login-button:hover {
            background: #5856eb;
        }
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        .chat-container {
            max-width: 900px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        .message {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 12px;
            border-left: 4px solid #6366f1;
        }
        .message.user {
            background: rgba(99, 102, 241, 0.2);
            border-left-color: #10b981;
            margin-left: 2rem;
        }
        .input-area {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .message-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
        }
        .message-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .send-button {
            padding: 0.75rem 1.5rem;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        .send-button:hover {
            background: #5856eb;
        }
        .send-button:disabled {
            background: #4b5563;
            cursor: not-allowed;
        }
        .profile-view {
            max-width: 600px;
            margin: 0 auto;
        }
        .profile-card {
            background: rgba(0,0,0,0.3);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .profile-field {
            margin: 1rem 0;
        }
        .profile-field label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255,255,255,0.8);
        }
        .profile-field input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .loading { opacity: 0.7; }
        
        /* Auth Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6366f1;
            margin-bottom: 0.5rem;
        }
        .modal-subtitle {
            color: rgba(255,255,255,0.7);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
        }
        .form-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .form-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        .form-button {
            width: 100%;
            padding: 0.75rem;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        .form-button:hover {
            background: #5856eb;
        }
        .form-button:disabled {
            background: #4b5563;
            cursor: not-allowed;
        }
        .form-error {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .form-link {
            text-align: center;
            margin-top: 1rem;
            color: rgba(255,255,255,0.7);
        }
        .form-link button {
            background: none;
            border: none;
            color: #6366f1;
            cursor: pointer;
            text-decoration: underline;
        }
        .auth-required {
            text-align: center;
            padding: 4rem 2rem;
        }
        .auth-required h2 {
            color: #6366f1;
            margin-bottom: 1rem;
        }
        .auth-required p {
            color: rgba(255,255,255,0.7);
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    üöÄ AI Scholar
                </div>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="showView('chat')">
                    üí¨ Chat
                </div>
                <div class="nav-item" onclick="showView('profile')" id="nav-profile">
                    üë§ Profile
                </div>
                <div class="nav-item" onclick="showView('analytics')" id="nav-analytics">
                    üìä Analytics
                </div>
                <div class="nav-item" onclick="showView('documents')" id="nav-documents">
                    üìÑ Documents
                </div>
                <div class="nav-item" onclick="showView('security')" id="nav-security">
                    üîí Security
                </div>
                <div class="nav-item" onclick="showView('workflows')" id="nav-workflows">
                    ‚ö° Workflows
                </div>
                <div class="nav-item" onclick="showView('integrations')" id="nav-integrations">
                    üîå Integrations
                </div>
                <div class="nav-item" onclick="showView('settings')" id="nav-settings">
                    ‚öôÔ∏è Settings
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <div class="header-title" id="header-title">Chat</div>
                <div class="header-actions">
                    <div id="user-menu" style="display: none;" class="user-menu" onclick="showUserMenu()">
                        <span id="user-name">User</span>
                        <span>‚ñº</span>
                    </div>
                    <button class="login-button" onclick="showAuthModal()" id="login-button">Sign In</button>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Chat View -->
                <div id="chat-view" class="chat-container">
                    <div class="messages-area" id="messages-area">
                        <div class="message">
                            <strong>AI Scholar:</strong> Welcome to AI Scholar, your intelligent research assistant! I'm here to help you with research, analysis, and academic work. Please sign in to access all features and get personalized assistance.
                        </div>
                    </div>
                    <div class="input-area">
                        <div class="input-container">
                            <input type="text" class="message-input" id="message-input" placeholder="Ask me anything about research..." />
                            <button class="send-button" onclick="sendMessage()" id="send-button">Send</button>
                        </div>
                    </div>
                </div>
                
                <!-- Profile View -->
                <div id="profile-view" class="profile-view" style="display: none;">
                    <div id="profile-content">
                        <div class="auth-required">
                            <h2>Authentication Required</h2>
                            <p>Please sign in to view and manage your profile.</p>
                            <button class="login-button" onclick="showAuthModal()">Sign In</button>
                        </div>
                    </div>
                </div>
                
                <!-- Other Views -->
                <div id="analytics-view" style="display: none;">
                    <div class="auth-required">
                        <h2>üìä Analytics Dashboard</h2>
                        <p>Sign in to access detailed analytics and insights about your research activities.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
                
                <div id="documents-view" style="display: none;">
                    <div class="auth-required">
                        <h2>üìÑ Document Manager</h2>
                        <p>Sign in to upload, organize, and manage your research documents.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
                
                <div id="security-view" style="display: none;">
                    <div class="auth-required">
                        <h2>üîí Security Dashboard</h2>
                        <p>Sign in to access security settings and monitoring tools.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
                
                <div id="workflows-view" style="display: none;">
                    <div class="auth-required">
                        <h2>‚ö° Workflow Manager</h2>
                        <p>Sign in to create and manage automated research workflows.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
                
                <div id="integrations-view" style="display: none;">
                    <div class="auth-required">
                        <h2>üîå Integration Hub</h2>
                        <p>Sign in to connect with third-party services and research tools.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
                
                <div id="settings-view" style="display: none;">
                    <div class="auth-required">
                        <h2>‚öôÔ∏è Settings</h2>
                        <p>Sign in to customize your preferences and application settings.</p>
                        <button class="login-button" onclick="showAuthModal()">Sign In</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Welcome Back</div>
                <div class="modal-subtitle">Sign in to your AI Scholar account</div>
            </div>
            
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="email" placeholder="Enter your email" required />
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter your password" required />
                </div>
                
                <div id="login-error" class="form-error" style="display: none;"></div>
                
                <button type="submit" class="form-button" id="login-submit">Sign In</button>
            </form>
            
            <div class="form-link">
                Don't have an account? 
                <button type="button" onclick="showRegisterForm()">Sign up</button>
            </div>
            
            <div class="form-link">
                <button type="button" onclick="hideAuthModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let isAuthenticated = false;
        let currentUser = null;
        let currentView = 'chat';
        
        function updateUI() {
            const loginButton = document.getElementById('login-button');
            const userMenu = document.getElementById('user-menu');
            const userName = document.getElementById('user-name');
            
            if (isAuthenticated) {
                loginButton.style.display = 'none';
                userMenu.style.display = 'flex';
                userName.textContent = currentUser?.name || 'User';
                updateProtectedViews();
                updateNavigation();
            } else {
                loginButton.style.display = 'block';
                userMenu.style.display = 'none';
                updateProtectedViews();
                updateNavigation();
            }
        }
        
        function updateNavigation() {
            const protectedNavs = ['nav-profile', 'nav-analytics', 'nav-documents', 'nav-security', 'nav-workflows', 'nav-integrations', 'nav-settings'];
            protectedNavs.forEach(navId => {
                const nav = document.getElementById(navId);
                if (isAuthenticated) {
                    nav.classList.remove('disabled');
                } else {
                    nav.classList.add('disabled');
                }
            });
        }
        
        function updateProtectedViews() {
            if (isAuthenticated && currentUser) {
                updateProfileView();
                // Update current view if it's a protected view
                const protectedViews = ['analytics', 'documents', 'security', 'workflows', 'integrations', 'settings'];
                if (protectedViews.includes(currentView)) {
                    updateProtectedViewContent(currentView);
                }
            }
        }
        
        function updateProfileView() {
            const profileContent = document.getElementById('profile-content');
            if (currentUser) {
                profileContent.innerHTML = `
                    <div class="profile-card">
                        <h2>üë§ User Profile</h2>
                        <div class="profile-field">
                            <label>Name:</label>
                            <input type="text" value="${currentUser.name}" readonly />
                        </div>
                        <div class="profile-field">
                            <label>Email:</label>
                            <input type="text" value="${currentUser.email}" readonly />
                        </div>
                        <div class="profile-field">
                            <label>Role:</label>
                            <input type="text" value="${currentUser.role}" readonly />
                        </div>
                        <div class="profile-field">
                            <label>Bio:</label>
                            <input type="text" value="${currentUser.bio || ''}" readonly />
                        </div>
                        <div class="profile-field">
                            <label>Location:</label>
                            <input type="text" value="${currentUser.location || ''}" readonly />
                        </div>
                        <div class="profile-field">
                            <label>Website:</label>
                            <input type="text" value="${currentUser.website || ''}" readonly />
                        </div>
                        <br>
                        <button class="send-button" onclick="updateProfile()">Update Profile</button>
                        <button class="login-button" onclick="logout()" style="margin-left: 10px;">Sign Out</button>
                    </div>
                `;
            }
        }
        
        function showAuthModal() {
            document.getElementById('auth-modal').style.display = 'flex';
            document.getElementById('email').focus();
        }
        
        function hideAuthModal() {
            document.getElementById('auth-modal').style.display = 'none';
            document.getElementById('login-form').reset();
            document.getElementById('login-error').style.display = 'none';
        }
        
        function showRegisterForm() {
            // For now, just show a message about registration
            addMessage('System', 'Registration feature coming soon! For now, please use the demo credentials or contact your administrator.', 'error');
            hideAuthModal();
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const submitButton = document.getElementById('login-submit');
            const errorDiv = document.getElementById('login-error');
            
            submitButton.textContent = 'Signing in...';
            submitButton.disabled = true;
            errorDiv.style.display = 'none';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('auth_token', data.access_token);
                    localStorage.setItem('refresh_token', data.refresh_token);
                    
                    isAuthenticated = true;
                    currentUser = data.user;
                    updateUI();
                    hideAuthModal();
                    
                    addMessage('System', `‚úÖ Welcome back, ${data.user.name}! You are now signed in.`, 'success');
                } else {
                    const errorData = await response.json();
                    errorDiv.textContent = errorData.detail || 'Invalid email or password';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Connection error. Please try again.';
                errorDiv.style.display = 'block';
            } finally {
                submitButton.textContent = 'Sign In';
                submitButton.disabled = false;
            }
        }
        
        function showUserMenu() {
            // Simple implementation - just show profile
            showView('profile');
        }
        
        function logout() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('refresh_token');
            isAuthenticated = false;
            currentUser = null;
            updateUI();
            
            addMessage('System', 'üëã You have been signed out successfully.', 'success');
            showView('chat');
        }
        
        async function updateProfile() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('/api/auth/profile', {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        bio: `Updated from AI Scholar at ${new Date().toISOString()}`
                    })
                });
                
                if (response.ok) {
                    const updatedUser = await response.json();
                    currentUser = updatedUser;
                    updateProfileView();
                    addMessage('System', '‚úÖ Profile updated successfully!', 'success');
                } else {
                    const errorText = await response.text();
                    addMessage('System', `‚ùå Profile update failed: ${errorText}`, 'error');
                }
            } catch (error) {
                addMessage('System', `‚ùå Profile update error: ${error.message}`, 'error');
            }
        }
        
        function showView(viewName) {
            // Check if user needs to be authenticated for this view
            const protectedViews = ['profile', 'analytics', 'documents', 'security', 'workflows', 'integrations', 'settings'];
            if (protectedViews.includes(viewName) && !isAuthenticated) {
                showAuthModal();
                return;
            }
            
            // Hide all views
            document.querySelectorAll('[id$="-view"]').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // Show selected view
            document.getElementById(viewName + '-view').style.display = 'block';
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // If no event (programmatic call), find and activate the nav item
                document.querySelector(`[onclick="showView('${viewName}')"]`)?.classList.add('active');
            }
            
            // Update protected views content based on auth state
            updateProtectedViewContent(viewName);
            
            // Update header title
            const titles = {
                'chat': 'Chat',
                'profile': 'Profile',
                'analytics': 'Analytics',
                'documents': 'Documents',
                'security': 'Security',
                'workflows': 'Workflows',
                'integrations': 'Integrations',
                'settings': 'Settings'
            };
            document.getElementById('header-title').textContent = titles[viewName] || viewName;
            currentView = viewName;
        }
        
        function updateProtectedViewContent(viewName) {
            if (!isAuthenticated) return;
            
            // Update content for authenticated users
            const viewContents = {
                'analytics': `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2>üìä Analytics Dashboard</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 2rem 0;">
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üìà Usage Statistics</h3>
                                <p>Track your research activity and productivity metrics.</p>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üéØ Research Insights</h3>
                                <p>Analyze patterns in your research topics and queries.</p>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>‚è±Ô∏è Time Tracking</h3>
                                <p>Monitor time spent on different research projects.</p>
                            </div>
                        </div>
                    </div>
                `,
                'documents': `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2>üìÑ Document Manager</h2>
                        <div style="background: rgba(0,0,0,0.3); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
                            <h3>üìÅ Your Documents</h3>
                            <p>Upload, organize, and manage your research documents.</p>
                            <div style="margin-top: 1rem;">
                                <button class="send-button">üì§ Upload Document</button>
                                <button class="send-button" style="margin-left: 10px;">üìÇ Browse Library</button>
                            </div>
                        </div>
                    </div>
                `,
                'security': `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2>üîí Security Dashboard</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 2rem 0;">
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üîê Account Security</h3>
                                <p>Manage passwords, two-factor authentication, and login sessions.</p>
                                <button class="send-button" style="margin-top: 10px;">Change Password</button>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üìä Activity Monitor</h3>
                                <p>Review recent login activity and security events.</p>
                                <button class="send-button" style="margin-top: 10px;">View Activity</button>
                            </div>
                        </div>
                    </div>
                `,
                'workflows': `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2>‚ö° Workflow Manager</h2>
                        <div style="background: rgba(0,0,0,0.3); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
                            <h3>üîÑ Automated Workflows</h3>
                            <p>Create and manage automated research processes and tasks.</p>
                            <div style="margin-top: 1rem;">
                                <button class="send-button">‚ûï Create Workflow</button>
                                <button class="send-button" style="margin-left: 10px;">üìã View Templates</button>
                            </div>
                        </div>
                    </div>
                `,
                'integrations': `
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2>üîå Integration Hub</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 2rem 0;">
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üìö Research Databases</h3>
                                <p>Connect to academic databases and libraries.</p>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>‚òÅÔ∏è Cloud Storage</h3>
                                <p>Sync with Google Drive, Dropbox, and other services.</p>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px;">
                                <h3>üîó API Connections</h3>
                                <p>Integrate with third-party research tools and services.</p>
                            </div>
                        </div>
                    </div>
                `,
                'settings': `
                    <div style="max-width: 600px; margin: 0 auto;">
                        <h2>‚öôÔ∏è Settings</h2>
                        <div style="background: rgba(0,0,0,0.3); padding: 2rem; border-radius: 8px; margin: 2rem 0;">
                            <h3>üé® Preferences</h3>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem;">Theme:</label>
                                <select style="padding: 0.5rem; border-radius: 4px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                    <option>Dark Mode</option>
                                    <option>Light Mode</option>
                                    <option>Auto</option>
                                </select>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem;">Language:</label>
                                <select style="padding: 0.5rem; border-radius: 4px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                    <option>English</option>
                                    <option>Spanish</option>
                                    <option>French</option>
                                </select>
                            </div>
                            <button class="send-button" style="margin-top: 1rem;">Save Settings</button>
                        </div>
                    </div>
                `
            };
            
            if (viewContents[viewName]) {
                document.getElementById(viewName + '-view').innerHTML = viewContents[viewName];
            }
        }
        
        function addMessage(sender, content, type = '') {
            const messagesArea = document.getElementById('messages-area');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'You' ? 'user' : ''} ${type}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${content}`;
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            
            addMessage('You', message);
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    `Great question about "${message}"! I'm here to help with your research needs.`,
                    `I understand you're asking about "${message}". Let me provide some insights on that topic.`,
                    `Thanks for your question: "${message}". I can help you explore this further.`,
                    `Interesting topic: "${message}". Would you like me to provide more detailed information?`
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage('AI Scholar', randomResponse);
            }, 1000);
        }
        
        // Check for existing auth on load
        window.addEventListener('load', () => {
            const token = localStorage.getItem('auth_token');
            if (token && token !== 'null' && token.length > 10) {
                fetch('/api/auth/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                }).then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Token invalid');
                }).then(user => {
                    isAuthenticated = true;
                    currentUser = user;
                    updateUI();
                    addMessage('System', `‚úÖ Welcome back, ${user.name}! You are already signed in.`, 'success');
                }).catch(() => {
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('refresh_token');
                });
            }
            updateUI();
        });
        
        // Enter key to send message
        document.getElementById('message-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideAuthModal();
            }
        });
        
        // Close modal on overlay click
        document.getElementById('auth-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                hideAuthModal();
            }
        });
    </script>
</body>
</html>