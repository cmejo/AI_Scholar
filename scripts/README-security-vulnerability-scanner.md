# Security Vulnerability Scanner

A comprehensive security vulnerability scanner and compliance checker designed specifically for the AI Scholar codebase with Ubuntu server compatibility focus.

## Overview

This security scanner provides comprehensive analysis across multiple security domains:

- **Dependency Vulnerability Scanning**: Python and Node.js package vulnerability detection
- **File Permission Analysis**: Ubuntu-compatible file permission and access control validation
- **Network Security Configuration**: Docker, Nginx, and service exposure validation
- **Authentication & Authorization Audit**: JWT, OAuth, password handling, and RBAC analysis
- **Configuration Security**: Environment files, Docker configurations, and secrets exposure
- **Ubuntu Compatibility**: Specific checks for Ubuntu server deployment compatibility

## Features

### üîç Comprehensive Scanning
- Python dependency vulnerability scanning (safety, pip-audit integration)
- Node.js dependency vulnerability scanning (npm audit integration)
- File permission and access control analysis
- Network security configuration validation
- Authentication mechanism auditing
- Authorization control verification
- Configuration security analysis
- Secrets exposure detection

### üêß Ubuntu Server Focus
- Ubuntu-specific file permission validation
- Docker container Ubuntu compatibility
- Network configuration for Ubuntu environments
- System service security on Ubuntu
- Package dependency Ubuntu compatibility

### üìä Detailed Reporting
- JSON format results for automation
- Markdown reports for documentation
- Summary reports for quick overview
- Issue categorization and prioritization
- Auto-fix recommendations
- Ubuntu-specific issue flagging

### üöÄ Integration Ready
- CLI interface for automation
- CI/CD pipeline integration
- Configurable severity thresholds
- Batch processing capabilities
- Performance optimized scanning

## Installation

### Prerequisites

```bash
# Python dependencies
pip install requests pyyaml

# Optional: Enhanced vulnerability scanning
pip install safety pip-audit

# Optional: Node.js vulnerability scanning
npm install -g npm
```

### Setup

```bash
# Make scripts executable
chmod +x scripts/security_vulnerability_scanner.py
chmod +x scripts/run_security_vulnerability_scan.py
chmod +x scripts/security_vulnerability_integration.py
```

## Usage

### Basic Scanning

```bash
# Scan current directory
python scripts/run_security_vulnerability_scan.py

# Scan specific project
python scripts/run_security_vulnerability_scan.py --project-root /path/to/project

# Generate reports in specific directory
python scripts/run_security_vulnerability_scan.py --output-dir ./security-reports

# Verbose output
python scripts/run_security_vulnerability_scan.py --verbose
```

### Output Options

```bash
# JSON output only
python scripts/run_security_vulnerability_scan.py --json-only

# Specific output file
python scripts/run_security_vulnerability_scan.py --output security_results.json

# Skip report generation
python scripts/run_security_vulnerability_scan.py --no-reports
```

### Direct Scanner Usage

```python
from security_vulnerability_scanner import SecurityVulnerabilityScanner

# Initialize scanner
scanner = SecurityVulnerabilityScanner("/path/to/project")

# Run comprehensive scan
results = scanner.run_comprehensive_scan()

# Access results
print(f"Total issues: {results['summary']['total_issues']}")
print(f"Critical issues: {results['summary']['critical_issues']}")
print(f"Ubuntu-specific: {results['summary']['ubuntu_specific_issues']}")
```

## Security Issue Types

### Dependency Vulnerabilities
- **Python packages**: Known CVEs, unpinned versions, vulnerable packages
- **Node.js packages**: npm audit results, flexible version ranges, known vulnerable packages
- **Severity mapping**: Critical, High, Medium, Low based on CVSS scores

### File Permissions
- **World-writable files**: Security risk identification
- **Executable permissions**: Script execution validation
- **Sensitive file exposure**: Credential and key file protection
- **Ubuntu-specific permissions**: System compatibility validation

### Network Security
- **Docker configurations**: Privileged containers, host networking, exposed ports
- **Nginx configurations**: TLS versions, security headers, server tokens
- **Service exposure**: Internal services exposed externally
- **Port security**: Insecure port usage detection

### Authentication & Authorization
- **JWT security**: Secret strength, expiration validation, algorithm security
- **OAuth security**: Client secret exposure, redirect URI validation
- **Password handling**: Hashing algorithms, plaintext storage detection
- **Session management**: Cookie security, HttpOnly flags
- **RBAC implementation**: Role validation, permission checks
- **SQL injection**: Query parameterization validation
- **Privilege escalation**: Dangerous function usage detection

### Configuration Security
- **Environment files**: Secret strength, default value detection
- **Docker security**: Root user usage, base image versions, ADD vs COPY
- **Secrets exposure**: API keys, tokens, credential detection in code
- **Debug mode**: Production configuration validation

## Report Formats

### JSON Report
```json
{
  "summary": {
    "timestamp": "2024-01-01T12:00:00",
    "total_issues": 25,
    "critical_issues": 2,
    "high_issues": 8,
    "ubuntu_specific_issues": 5,
    "auto_fixable_issues": 12
  },
  "issues": [
    {
      "id": "JWT_WEAK_SECRET_auth.py_15",
      "type": "authentication",
      "severity": "critical",
      "file_path": "backend/auth.py",
      "line_number": 15,
      "description": "Weak or hardcoded JWT secret detected",
      "recommendation": "Use strong, randomly generated secrets from environment variables",
      "ubuntu_specific": false,
      "auto_fixable": false,
      "cve_id": null
    }
  ],
  "recommendations": [
    "Address 2 critical security issues immediately",
    "Review and fix 8 high-severity security issues"
  ]
}
```

### Markdown Report
- Executive summary with risk assessment
- Issues categorized by type and severity
- Detailed recommendations with file locations
- Ubuntu-specific issue highlighting
- Auto-fix suggestions

### Summary Report
- Quick overview of issue counts
- Critical issue details
- Ubuntu-specific issues summary
- Auto-fixable issues list

## Integration

### CI/CD Pipeline

```yaml
# GitHub Actions example
- name: Security Vulnerability Scan
  run: |
    python scripts/run_security_vulnerability_scan.py \
      --output security_results.json \
      --no-reports
    
    # Fail build on critical issues
    if [ $? -eq 1 ]; then
      echo "Critical security issues found"
      exit 1
    fi
```

### Pre-commit Hook

```bash
#!/bin/bash
# .git/hooks/pre-commit
python scripts/run_security_vulnerability_scan.py --json-only | \
  jq -r '.summary.critical_issues' | \
  xargs -I {} test {} -eq 0 || {
    echo "Critical security issues found. Commit blocked."
    exit 1
  }
```

## Testing

### Unit Tests
```bash
# Run unit tests
python scripts/test_security_vulnerability_scanner.py
```

### Integration Tests
```bash
# Run integration tests
python scripts/security_vulnerability_integration.py

# With specific project
python scripts/security_vulnerability_integration.py --project-root /path/to/project

# Save test results
python scripts/security_vulnerability_integration.py --output integration_results.json
```

## Configuration

### Environment Variables
```bash
# Optional: Configure external tools
export SAFETY_API_KEY="your_safety_api_key"
export NPM_CONFIG_AUDIT_LEVEL="moderate"
```

### Custom Patterns
The scanner can be extended with custom vulnerability patterns and checks by modifying the scanner class methods.

## Ubuntu Compatibility

### Specific Checks
- File permission compatibility with Ubuntu's default umask
- Docker container base image Ubuntu compatibility
- Network service configuration for Ubuntu
- System package dependency validation
- Shell script Ubuntu compatibility

### Common Issues Detected
- World-writable files that may cause issues on Ubuntu
- Docker containers running as root (security risk on Ubuntu)
- Network services exposed on all interfaces
- Missing executable permissions on scripts
- Hardcoded paths that may not exist on Ubuntu

## Performance

### Benchmarks
- **Small projects** (< 100 files): < 30 seconds
- **Medium projects** (100-1000 files): < 2 minutes
- **Large projects** (1000+ files): < 5 minutes

### Optimization
- Parallel scanning of different issue types
- Efficient file system traversal
- Configurable scan depth and exclusions
- Memory-efficient processing of large files

## Troubleshooting

### Common Issues

1. **Permission Denied Errors**
   ```bash
   chmod +x scripts/*.py
   ```

2. **Missing Dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Timeout Issues**
   - Increase timeout for large projects
   - Use `--verbose` flag for debugging

4. **False Positives**
   - Review `.gitignore` patterns
   - Check file exclusion logic
   - Validate secret detection patterns

### Debug Mode
```bash
python scripts/run_security_vulnerability_scan.py --verbose
```

## Contributing

### Adding New Checks
1. Extend the `SecurityVulnerabilityScanner` class
2. Add new issue types to `SecurityIssueType` enum
3. Implement detection logic in appropriate method
4. Add unit tests for new functionality
5. Update documentation

### Issue Categories
- Follow existing pattern for issue categorization
- Include Ubuntu-specific flag when applicable
- Provide actionable recommendations
- Mark auto-fixable issues appropriately

## License

This security vulnerability scanner is part of the AI Scholar project and follows the same licensing terms.

## Support

For issues, questions, or contributions:
1. Check existing documentation
2. Run integration tests to validate setup
3. Use verbose mode for debugging
4. Review test cases for usage examples