<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Final Diagnosis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .hero {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: 2.5em;
            margin: 0 0 10px 0;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }
        .test-card h3 {
            color: #10b981;
            margin-top: 0;
        }
        .app-frame {
            width: 100%;
            height: 400px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: white;
            margin: 15px 0;
        }
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .warning { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        button {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        button:hover {
            transform: translateY(-1px);
        }
        .console-output {
            background: rgba(0,0,0,0.8);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 250px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .diagnosis-summary {
            background: linear-gradient(45deg, #7c3aed, #a855f7);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #10b981;
        }
        .metric-label {
            font-size: 0.9em;
            color: #cbd5e1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üî¨ React Application Final Diagnosis</h1>
            <p>Comprehensive analysis of AI Scholar React application status</p>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>üöÄ Live Application Test</h3>
                <div id="app-status" class="status info">Initializing...</div>
                <iframe src="http://localhost:8080" class="app-frame" id="app-frame"></iframe>
                <button onclick="reloadApp()">üîÑ Reload App</button>
                <button onclick="openApp()">üîó Open in New Tab</button>
            </div>

            <div class="test-card">
                <h3>üì¶ Bundle Analysis</h3>
                <div id="bundle-analysis">
                    <div>Bundle Path: <span id="bundle-path">Checking...</span></div>
                    <div>Bundle Size: <span id="bundle-size">Checking...</span></div>
                    <div>React Content: <span id="react-content">Checking...</span></div>
                    <div>App Content: <span id="app-content">Checking...</span></div>
                </div>
                <button onclick="analyzeBundleDetailed()">üîç Deep Analysis</button>
            </div>

            <div class="test-card">
                <h3>üåê Network & Server</h3>
                <div id="network-status">
                    <div>Server Status: <span id="server-status">Checking...</span></div>
                    <div>Response Time: <span id="response-time">Checking...</span></div>
                    <div>Content Type: <span id="content-type">Checking...</span></div>
                    <div>Cache Status: <span id="cache-status">Checking...</span></div>
                </div>
                <button onclick="testNetwork()">üåê Test Network</button>
            </div>

            <div class="test-card">
                <h3>üß† DOM & Rendering</h3>
                <div id="dom-status">
                    <div>Root Element: <span id="root-element">Checking...</span></div>
                    <div>Content Rendered: <span id="content-rendered">Checking...</span></div>
                    <div>React Mount: <span id="react-mount">Checking...</span></div>
                    <div>JavaScript Errors: <span id="js-errors">Checking...</span></div>
                </div>
                <button onclick="checkDOM()">üîç Check DOM</button>
            </div>
        </div>

        <div class="test-card">
            <h3>üñ•Ô∏è Console Monitor</h3>
            <div class="console-output" id="console-output">
                Starting comprehensive diagnosis...<br>
            </div>
            <button onclick="clearConsole()">üóëÔ∏è Clear</button>
            <button onclick="exportDiagnosis()">üíæ Export Report</button>
        </div>

        <div class="diagnosis-summary">
            <h2>üìä Diagnosis Summary</h2>
            <div class="metric-grid">
                <div class="metric">
                    <div class="metric-value" id="overall-health">--</div>
                    <div class="metric-label">Overall Health</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="bundle-health">--</div>
                    <div class="metric-label">Bundle Health</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="render-health">--</div>
                    <div class="metric-label">Render Health</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="network-health">--</div>
                    <div class="metric-label">Network Health</div>
                </div>
            </div>
            <div id="diagnosis-conclusion" class="status info">
                Running comprehensive diagnosis...
            </div>
        </div>
    </div>

    <script>
        const consoleOutput = document.getElementById('console-output');
        let diagnosticData = {
            server: { status: false, responseTime: 0 },
            bundle: { exists: false, size: 0, hasReact: false, hasApp: false },
            dom: { rootExists: false, hasContent: false, reactMounted: false },
            network: { working: false, contentType: '', cached: false }
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00ff00',
                error: '#ff4444',
                warning: '#ffaa00',
                success: '#00ff88',
                debug: '#888888'
            };
            consoleOutput.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span><br>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = 'Console cleared...<br>';
        }

        function reloadApp() {
            document.getElementById('app-frame').src = 'http://localhost:8080?t=' + Date.now();
            log('App reloaded', 'info');
        }

        function openApp() {
            window.open('http://localhost:8080', '_blank');
            log('App opened in new tab', 'info');
        }

        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            const statusClass = status === 'success' ? 'success' : 
                               status === 'error' ? 'error' : 
                               status === 'warning' ? 'warning' : 'info';
            element.className = `status ${statusClass}`;
            element.textContent = message;
        }

        async function testNetwork() {
            log('üåê Testing network connectivity...', 'info');
            const startTime = Date.now();

            try {
                const response = await fetch('http://localhost:8080', { 
                    cache: 'no-cache',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                const responseTime = Date.now() - startTime;
                
                diagnosticData.network.working = response.ok;
                diagnosticData.server.responseTime = responseTime;
                diagnosticData.network.contentType = response.headers.get('content-type') || 'unknown';
                diagnosticData.network.cached = response.headers.get('cache-control')?.includes('max-age') || false;

                document.getElementById('server-status').textContent = response.ok ? '‚úÖ Online' : '‚ùå Error';
                document.getElementById('response-time').textContent = `${responseTime}ms`;
                document.getElementById('content-type').textContent = diagnosticData.network.contentType;
                document.getElementById('cache-status').textContent = diagnosticData.network.cached ? 'üì¶ Cached' : 'üîÑ Fresh';

                log(`Server response: ${response.status} in ${responseTime}ms`, response.ok ? 'success' : 'error');
            } catch (error) {
                log(`Network test failed: ${error.message}`, 'error');
                document.getElementById('server-status').textContent = '‚ùå Offline';
            }
        }

        async function analyzeBundleDetailed() {
            log('üì¶ Starting detailed bundle analysis...', 'info');

            try {
                const response = await fetch('http://localhost:8080');
                const html = await response.text();
                
                const scriptMatch = html.match(/src="([^"]*index[^"]*\.js)"/);
                if (scriptMatch) {
                    const bundlePath = scriptMatch[1];
                    diagnosticData.bundle.exists = true;
                    
                    document.getElementById('bundle-path').textContent = bundlePath;
                    log(`Found bundle: ${bundlePath}`, 'success');

                    const bundleResponse = await fetch(`http://localhost:8080${bundlePath}`);
                    const bundleContent = await bundleResponse.text();
                    const bundleSize = bundleContent.length;
                    
                    diagnosticData.bundle.size = bundleSize;
                    document.getElementById('bundle-size').textContent = `${(bundleSize / 1024).toFixed(2)} KB`;

                    // Detailed content analysis
                    const hasReact = bundleContent.includes('useState') || 
                                   bundleContent.includes('useEffect') || 
                                   bundleContent.includes('React') ||
                                   bundleContent.includes('jsx');
                    
                    const hasAppContent = bundleContent.includes('AI Scholar') ||
                                        bundleContent.includes('MINIMAL WORKING') ||
                                        bundleContent.includes('App') ||
                                        bundleContent.includes('Hello');

                    diagnosticData.bundle.hasReact = hasReact;
                    diagnosticData.bundle.hasApp = hasAppContent;

                    document.getElementById('react-content').innerHTML = hasReact ? 
                        '<span style="color: #10b981;">‚úÖ Found</span>' : 
                        '<span style="color: #ef4444;">‚ùå Missing</span>';
                    
                    document.getElementById('app-content').innerHTML = hasAppContent ? 
                        '<span style="color: #10b981;">‚úÖ Found</span>' : 
                        '<span style="color: #ef4444;">‚ùå Missing</span>';

                    log(`Bundle analysis: Size=${(bundleSize/1024).toFixed(2)}KB, React=${hasReact}, App=${hasAppContent}`, 'debug');

                    // Check for specific patterns
                    if (bundleSize < 10000) {
                        log('‚ö†Ô∏è Bundle is very small - possible build issue', 'warning');
                    }
                    if (!hasReact) {
                        log('‚ùå No React code found in bundle', 'error');
                    }
                    if (!hasAppContent) {
                        log('‚ùå No app-specific content found in bundle', 'error');
                    }

                } else {
                    log('‚ùå No bundle script found in HTML', 'error');
                    document.getElementById('bundle-path').textContent = 'Not found';
                }
            } catch (error) {
                log(`Bundle analysis failed: ${error.message}`, 'error');
            }
        }

        function checkDOM() {
            log('üß† Checking DOM and rendering...', 'info');

            try {
                const iframe = document.getElementById('app-frame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                if (iframeDoc) {
                    const rootElement = iframeDoc.getElementById('root');
                    diagnosticData.dom.rootExists = !!rootElement;
                    
                    if (rootElement) {
                        const hasContent = rootElement.innerHTML.trim().length > 0;
                        const childCount = rootElement.children.length;
                        
                        diagnosticData.dom.hasContent = hasContent;
                        diagnosticData.dom.reactMounted = hasContent && childCount > 0;

                        document.getElementById('root-element').textContent = '‚úÖ Found';
                        document.getElementById('content-rendered').textContent = hasContent ? '‚úÖ Yes' : '‚ùå No';
                        document.getElementById('react-mount').textContent = diagnosticData.dom.reactMounted ? '‚úÖ Yes' : '‚ùå No';

                        log(`DOM check: Root exists, Content=${hasContent}, Children=${childCount}`, 'success');
                        
                        if (!hasContent) {
                            log('‚ö†Ô∏è Root element is empty - React not mounting', 'warning');
                        }
                    } else {
                        document.getElementById('root-element').textContent = '‚ùå Missing';
                        log('‚ùå Root element not found', 'error');
                    }

                    // Check for JavaScript errors
                    const errors = iframeDoc.querySelectorAll('.error, [data-error]');
                    document.getElementById('js-errors').textContent = errors.length > 0 ? `‚ùå ${errors.length} found` : '‚úÖ None';

                } else {
                    log('‚ö†Ô∏è Cannot access iframe document (CORS)', 'warning');
                    document.getElementById('root-element').textContent = 'CORS blocked';
                    document.getElementById('content-rendered').textContent = 'Unknown';
                    document.getElementById('react-mount').textContent = 'Unknown';
                    document.getElementById('js-errors').textContent = 'Unknown';
                }
            } catch (error) {
                log(`DOM check failed: ${error.message}`, 'error');
            }
        }

        function updateHealthMetrics() {
            const serverHealth = diagnosticData.server.responseTime > 0 && diagnosticData.network.working ? 100 : 0;
            const bundleHealth = diagnosticData.bundle.exists && diagnosticData.bundle.hasReact && diagnosticData.bundle.size > 5000 ? 100 : 
                                diagnosticData.bundle.exists ? 50 : 0;
            const renderHealth = diagnosticData.dom.reactMounted ? 100 : 
                                diagnosticData.dom.hasContent ? 50 : 0;
            const networkHealth = diagnosticData.network.working ? 100 : 0;
            
            const overallHealth = Math.round((serverHealth + bundleHealth + renderHealth + networkHealth) / 4);

            document.getElementById('overall-health').textContent = `${overallHealth}%`;
            document.getElementById('bundle-health').textContent = `${bundleHealth}%`;
            document.getElementById('render-health').textContent = `${renderHealth}%`;
            document.getElementById('network-health').textContent = `${networkHealth}%`;

            // Update conclusion
            let conclusion = '';
            if (overallHealth >= 80) {
                conclusion = '‚úÖ Application is healthy and working correctly';
                updateStatus('app-status', 'success', 'Healthy');
            } else if (overallHealth >= 50) {
                conclusion = '‚ö†Ô∏è Application has some issues but is partially functional';
                updateStatus('app-status', 'warning', 'Partial Issues');
            } else {
                conclusion = '‚ùå Application has significant issues and may not be working';
                updateStatus('app-status', 'error', 'Critical Issues');
            }

            document.getElementById('diagnosis-conclusion').textContent = conclusion;
            log(`Health metrics updated: Overall=${overallHealth}%`, 'info');
        }

        function exportDiagnosis() {
            const report = {
                timestamp: new Date().toISOString(),
                diagnosticData,
                logs: consoleOutput.innerText,
                healthMetrics: {
                    overall: document.getElementById('overall-health').textContent,
                    bundle: document.getElementById('bundle-health').textContent,
                    render: document.getElementById('render-health').textContent,
                    network: document.getElementById('network-health').textContent
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `react-diagnosis-${new Date().toISOString().slice(0,19)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            log('Diagnosis report exported', 'success');
        }

        async function runComprehensiveDiagnosis() {
            log('üöÄ Starting comprehensive diagnosis...', 'info');
            
            await testNetwork();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await analyzeBundleDetailed();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            checkDOM();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateHealthMetrics();
            log('‚úÖ Comprehensive diagnosis completed', 'success');
        }

        // Monitor iframe load
        document.getElementById('app-frame').addEventListener('load', () => {
            log('üì± App iframe loaded', 'info');
            setTimeout(checkDOM, 2000);
        });

        // Auto-run diagnosis
        window.addEventListener('load', () => {
            setTimeout(runComprehensiveDiagnosis, 1000);
        });
    </script>
</body>
</html>